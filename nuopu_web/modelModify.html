<!DOCTYPE html>
<html lang="en">
	<head>
		<title>诺普信息技术</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        <meta http-equiv="Access-Control-Allow-Origin" content="*">
		<link href="https://fonts.googleapis.com/css?family=Electrolize:400" rel="stylesheet" type="text/css">
		<script async="" src="//www.google-analytics.com/analytics.js"></script>
		<script type="text/javascript" src="./js/jquery-ui-1.10.4.custom/js/jquery-1.10.2.js"></script>
		<script type="text/javascript" src="./js/jquery-ui-1.10.4.custom/js/jquery-ui-1.10.4.custom.min.js"></script>
		<link rel="stylesheet" href="./js/jquery-ui-1.10.4.custom/css_smoothness/jquery-ui.css">
		<link rel="stylesheet" href="style.css" type="text/css" media="screen">
		<script type="text/javascript" src="gui.js"></script>

		<script type="text/javascript" src="../dat.gui-master/build/dat.gui.js"></script>
		<script src="../build/three.js"></script>
		<script src="../build/three.module.js"></script>
		<script src="../dat.gui-master/tests/jquery.js"></script>
		<script src="./utils/LoadGui.js"></script>
		<script src="../examples/js/controls/OrbitControls.js"></script>
		<script src="../examples/js/QuickHull.js"></script>
		<script src="../examples/js/geometries/ConvexGeometry.js"></script>
		<script src="../examples/js/Detector.js"></script>
		<script src="../examples/js/libs/stats.min.js"></script>
		<script src="../examples/js/loaders/STLLoader.js"></script>
		<script src="../examples/js/loaders/OBJLoader.js"></script>
		<script src="../examples/js/loaders/PLYLoader.js"></script>
	</head>

	<body class="unselectable">
		<div id="content">
			<div class="centeredDiv">
				<div class="header">
					<div class="banner"><a href="/index.php"><img src="./images/EdgeWinLogo_2.png"></a></div>
					<div class="menu"><ul class="menu">
						<li>
							<a href="/projects/" color="#ffffff">刀具种类</a>
						</li>
						<li>
							<a href="/shop/">技术秒杀</a>
						</li>
						<li>
							<a href="/blog">帮助</a>
						</li>
					</ul>
					</div>
					<ul class="info">
						<li id="loginOrLogout" class="info"><a class="info" href="/shop/login.php">login</a></li>
						<li id="myAccount" class="info" style="display:none;"><a class="info" href="/shop/account.php">my account</a></li>
						<li id="cartLabel" class="info"><a class="info" href="/shop/shopping_cart.php">cart:</a>
							<span id="cartContents" style="font-size:9px">
						 0 items						 </span>
						</li>
					</ul>
				</div>
			</div>
			<div class="app">
				<!-- facebook like button stuff -->
				<div id="fb-root"></div>
				<script>(function(d, s, id) {
                    var js, fjs = d.getElementsByTagName(s)[0];
                    if (d.getElementById(id)) return;
                    js = d.createElement(s); js.id = id;
                    js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.0";
                    fjs.parentNode.insertBefore(js, fjs);
                }(document, 'script', 'facebook-jssdk'));</script>
				<!-- end facebook stuff -->
				<div class="appTitle noSelect">
					<div>
						<div class="appName">钻头</div><img src="./images/EdgeWinLogo_1.png" height="80" width="80">
					</div>
				</div>
				<div id="canvas">
						<div id="gameCanvas" width="1280px" height="811"></div>
						<div id="divPdfView" class="pdfView" style="visibility: hidden">
							<embed id="pdfCtrl" src="./pdf/test1.pdf" type="application/pdf" width="1440px" height="630"></embed>
						</div>
				</div>

				<div class="appTab noSel" id="tab" onclick="setTimeout(openTab,50);">
					<div class="appLabel">choose a product</div>
					<div class="appValue" id="tLabel">ring</div>
				</div>

				<div class="toolBox">
					<div class="section section_sculpt">
						<div class="appLabel">sculpt</div>
						<div class="panel">
							<div id="subdivide" class="imgButtonSelected" onclick="activateButton('mainView');">
								<a class="tooltipI">
									<img src="images/subdivideIcon_w.png">
									<div>主视图</div>
								</a>
							</div>
							<div id="merge" class="imgButton" onclick="activateButton('topView');"><a class="tooltipI"><img src="images/mergeIcon_w.png"><div>俯视图</div></a></div>
							<div id="modify" class="imgButton" onclick="activateButton('leftView');"><a class="tooltipI"><img src="images/modifyIcon_w.png"><div>左视图</div></a></div>
						</div>

					</div>
					<div class="section section_twist">
						<div class="appLabel">twist</div>
						<div class="sliderBox">
							<div class="sLabel" id="outsideLabel_twist" style="display: block;">outside</div>
							<div id="twist" class="slider ui-slider ui-slider-horizontal ui-widget ui-widget-content ui-corner-all" aria-disabled="false"><div class="ui-slider-range ui-widget-header ui-corner-all ui-slider-range-min" style="width: 63.9999%;"></div><a class="ui-slider-handle ui-state-default ui-corner-all" href="#" style="left: 63.9999%;"></a></div>
						</div>
						<div class="sliderBox" id="sliderTwist_inside" style="display: block;">
							<div class="sLabel">inside</div>
							<div id="twist2" class="slider ui-slider ui-slider-horizontal ui-widget ui-widget-content ui-corner-all" aria-disabled="false"><div class="ui-slider-range ui-widget-header ui-corner-all ui-slider-range-min" style="width: 26.9999%;"></div><a class="ui-slider-handle ui-state-default ui-corner-all" href="#" style="left: 26.9999%;"></a></div>
						</div>
					</div>

					<div class="section section_material">
						<div class="appLabel">material</div>
						<div id="materials"><div class="matFam"><div class="cLabel">nylon</div><div class="swatchContainer"><div class="swatchBox"><div class="swatch swatchSelect" id="swatch0" style="background-color: rgb(240, 241, 240);"></div><div class="tip">white</div></div><div class="swatchBox"><div class="swatch" id="swatch1" style="background-color: rgb(33, 33, 33);"></div><div class="tip">black</div></div><div class="swatchBox"><div class="swatch" id="swatch2" style="background-color: rgb(241, 24, 19);"></div><div class="tip">red</div></div><div class="swatchBox"><div class="swatch" id="swatch3" style="background-color: rgb(33, 46, 161);"></div><div class="tip">blue</div></div><div class="swatchBox"><div class="swatch" id="swatch4" style="background-color: rgb(255, 235, 0);"></div><div class="tip">yellow</div></div><div class="swatchBox"><div class="swatch" id="swatch5" style="background-color: rgb(242, 22, 94);"></div><div class="tip">pink</div></div></div></div><div class="matFam"><div class="cLabel">metal</div><div class="swatchContainer"><div class="swatchBox"><div class="swatch" id="swatch6" style="background-color: rgb(153, 153, 153);"><img src="images/materials/silver.jpg"></div><div class="tip">silver</div></div><div class="swatchBox"><div class="swatch" id="swatch7" style="background-color: rgb(193, 146, 68);"><img src="images/materials/brass.jpg"></div><div class="tip">brass</div></div><div class="swatchBox"><div class="swatch" id="swatch8" style="background-color: rgb(229, 164, 52);"><img src="images/materials/brass.jpg"></div><div class="tip">14k gold</div></div></div></div></div>
						<div class="selectedMaterial">
							<div class="name" id="matName">white</div>
							<div class="info" id="matInfo">polished 3d-printed nylon plastic</div>
						</div>
					</div>

					<div class="section section_price">
						<div class="appLabel">price</div>
						<div class="price">
							<div id="price" class="dollar">$26</div>
							<div id="shipsIn"> ships in<br>2 weeks</div>
						</div>
						<div class="appLabel">title</div>
						<input type="text" id="designTitle" placeholder="name your design">
					</div>
					<div class="section section_buy">
						<div class="button" onclick="Display3DModel();">三维模型</div>
						<div class="button" onclick="DisplayTuZhi();">二维图纸</div>
					</div>
					<div class="nervousLogo noSel">
						<a href="http://n-e-r-v-o-u-s.com"><img src="images/EdgeWinLogo_3.png"></a>
					</div>
				</div>
				<div class="webBar">
					<div class="socialMedia">
						<div class="twitter">
							<a href="https://twitter.com/share" class="twitter-share-button" data-url="http://n-e-r-v-o-u-s.com/kinematics" data-text="Kinematics app by @nervous_system: create flexible, articulated jewelry for 3D printing" data-hashtags="kinematics">Tweet</a>
							<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
						</div>
						<div class="fb-like" data-href="http://n-e-r-v-o-u-s.com/kinematics" data-layout="button_count" data-action="like" data-show-faces="false" data-share="false"></div>
					</div>
				</div>
			</div>
		</div>
		<script src="/shop/includes/js/footer.js" type="text/javascript"></script>
		<div id="footer" class="footer" style="top: 887px;">
			<div class="centeredDiv">
				<div class="chunk">
					<div class="title">social media</div>
					<a href="https://twitter.com/nervous_system"><img src="/includes/socialIcons/twitter.png"></a>
					<a href="https://www.facebook.com/NervousSystemStudio"><img src="/includes/socialIcons/facebook.png"></a>
					<a href="https://www.flickr.com/photos/jrosenk/"><img src="/includes/socialIcons/flickr.png"></a>
					<div class="copyright">© Nervous System, inc.</div>
				</div>


				<div class="chunk">
					<div class="title">policies</div>
					<ul>
						<li><a href="/shipping.php">shipping</a></li>
						<li><a href="/returns.php">returns</a></li>
						<li><a href="/privacy.php">privacy</a></li>
						<li><a href="/tos.php">apps terms of use</a></li>
					</ul>
				</div>
				<div class="chunk">
					<div class="title">company</div>
					<ul>
						<li><a href="/about_us.php">about</a></li>
						<li><a href="/contact.php">contact</a></li>
						<li><a href="/events.php">events</a></li>
						<li><a href="/jobs.php">jobs</a></li>
						<li><a href="/stockists.php">stockists</a></li>
					</ul>
				</div>


				<div class="chunk">
					<div class="title">mailing list</div>

					<!-- Begin MailChimp Signup Form -->
					<div id="mc_embed_signup">
						<form action="//n-e-r-v-o-u-s.us1.list-manage.com/subscribe/post?u=92f87c89f11018afd70016709&amp;id=66349e3942" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate="">
							<div id="mc_embed_signup_scroll">

								<div class="mc-field-group">
									<!--<label for="mce-EMAIL">Email Address </label>-->
									<input data-role="none" type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL" placeholder="email">
									<input data-role="none" type="submit" value="join" name="subscribe" id="mc-embedded-subscribe" class="button">
								</div>
								<div id="mce-responses" class="clear">
									<div class="response" id="mce-error-response" style="display:none"></div>
									<div class="response" id="mce-success-response" style="display:none"></div>
								</div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
								<div style="position: absolute; left: -5000px;"><input type="text" name="b_92f87c89f11018afd70016709_66349e3942" tabindex="-1" value=""></div>

							</div>
						</form>
					</div>

					<!--End mc_embed_signup-->
				</div>
			</div>
		</div>
		<script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-2451380-1', 'n-e-r-v-o-u-s.com');
			//ga('' );
            ga('send', 'pageview');
		</script>

		<script>

			function AddAxisArrowHelper(scene)
			{
                var Xdir = new THREE.Vector3(1,0,0);
                var Ydir = new THREE.Vector3(0,1,0);
                var Zdir = new THREE.Vector3(0,0,1);

				//确定原点，箭头长度，和箭头颜色，三个箭头同一设置
                var origin = new THREE.Vector3(0,0,0);
                var length = 200;
                var color = 0xffff00;

				//建立三个方向上箭头辅助
                var YarrowHelper = new THREE.ArrowHelper(Ydir,origin,length,0xff0000);
                var ZarrowHelper = new THREE.ArrowHelper(Zdir,origin,length,0x0000ff);
                var XarrowHelper = new THREE.ArrowHelper(Xdir,origin,length,0x00ff00);
				//把箭头辅助加入 场景
                scene.add(YarrowHelper);
                scene.add(ZarrowHelper);
                scene.add(XarrowHelper);
			}

            if ( ! Detector.webgl ) Detector.addGetWebGLMessage();

			var container;
			var modelArray = new Array();
			var camera, scene, renderer;
			var orbitControls;
			var modelNode;
			var xzPlane,xyPlane,yzPlane;
			var axisHelper;
			var lastModelColor;
            var menuObj = {};
            var textureCube;
            var reflectMaterial;

			var mouseX = 0, mouseY = 0;

			//var width = 800;
			//var height = 600;
			var windowHalfX = window.innerWidth / 2;
			var windowHalfY = window.innerHeight / 2;
            //var windowHalfX = width / 2;
           // var windowHalfY = height / 2;

            function onClickUpdateModel(geometry)
            {
                var material = null;
                if (geometry.hasColors) {
                    material = new THREE.MeshPhongMaterial({ opacity: geometry.alpha, vertexColors: THREE.VertexColors });
                }
                else
                {
                    material = new THREE.MeshPhongMaterial( { color: 0xAAAAAA, specular: 0x111111, shininess: 200 } );
                }

                var mesh = new THREE.Mesh( geometry, material );

                mesh.position.set( 0, 0, 0);
                mesh.rotation.set( - Math.PI / 2, 0, 0 );
                mesh.scale.set( 1,1,1 );

                mesh.castShadow = true;
                mesh.receiveShadow = true;

                //object.position.y = - 95;
                scene.add( mesh );
                modelArray.push(mesh);

                modelNode = mesh;
            }
            function removeAllSceneModel()
			{
			    var i = 0;
			    for(i = 0; i < modelArray.length; i++)
				{
				    scene.remove(modelArray[i]);
				}

				modelArray = new Array();
			}
            function onCallBack(response)
			{
                var onProgress = function ( xhr ) {

                };

                var onError = function ( xhr ) {
                };

                removeAllSceneModel();

                var jsonObj = eval('(' + response + ')');
                var modelFileList = jsonObj.ModelFileList;
                var pdfFile = jsonObj.PdfList[0];
                var pdfCtrl = document.getElementById( 'pdfCtrl' );
                pdfCtrl.src = 'http://localhost:1337/' + pdfFile;

                var i = 0;
                for(i = 0; i < modelFileList.length; i++)
				{
				    var requestURL = 'http://localhost:1337' + modelFileList[i].URL;
                    var modelColor = modelFileList[i].DefaultColor;
					//var a = "#" + modelColor;
					//menuObj["模型颜色" + (i + 1)] = "#" + modelColor;

                    var loader = new THREE.STLLoader();
                    loader.load(requestURL, function ( geometry ){
                        onClickUpdateModel(geometry);
                    },onProgress,onError);
				}
			}

            LoadGUIByConfig("config/config.json",onCallBack,menuObj);

			init();
			animate();

			function init() {

				container = document.getElementById( 'gameCanvas' );
				//container.width = 800;
				//container.height = 600;
				//document.body.appendChild( container );

				camera = new THREE.PerspectiveCamera( 45, 800 / 600, 1, 2000 );
				camera.position.z = 250;

				// scene

				scene = new THREE.Scene();

				var ambientLight = new THREE.AmbientLight( 0xcccccc, 0.4 );
				scene.add( ambientLight );

				var pointLight = new THREE.PointLight( 0xffffff, 0.8 );
				camera.add( pointLight );
				scene.add( camera );

                axisHelper = new THREE.AxisHelper(200);
                axisHelper.material.depthTest = false;
                scene.add(axisHelper);

                var planeGeometry = new THREE.PlaneGeometry(60,40,10,10);
                //平面材质，基本材质是渲染不出阴影的，下面的材质可以，仅仅指定颜色
                var planeMaterial = new THREE.MeshLambertMaterial({color:0xff00dd});
                planeMaterial.wireframe = true;
                //以给定的尺寸和材质构建一个平面
                xzPlane = new THREE.Mesh(planeGeometry,planeMaterial);
                //指定平面的旋转角度，方便观察
                xzPlane.rotation.x = -0.5 * Math.PI;
                //平面的位置
                xzPlane.position.x = 0;
                xzPlane.position.y = 0;
                xzPlane.position.z = 0;
                //平面加入场景
                scene.add(xzPlane);

                planeMaterial = new THREE.MeshLambertMaterial({color:0x00ffdd});
                planeMaterial.wireframe = true;
                yzPlane = new THREE.Mesh(planeGeometry,planeMaterial);
                yzPlane.rotation.y = -0.5 * Math.PI;
                yzPlane.position.x = 0;
                yzPlane.position.y = 0;
                yzPlane.position.z = 0;
                scene.add(yzPlane);

                planeMaterial = new THREE.MeshLambertMaterial({color:0xffdd00});
                planeMaterial.wireframe = true;
                xyPlane = new THREE.Mesh(planeGeometry,planeMaterial);
                //指定平面的旋转角度，方便观察
                xyPlane.rotation.z = -0.5 * Math.PI;
                //平面的位置
                xyPlane.position.x = 0;
                xyPlane.position.y = 0;
                xyPlane.position.z = 0;
                //平面加入场景
                scene.add(xyPlane);

                var path = "../examples/textures/cube/skybox/";
                var urls = [
                    path + "px.jpg", path + "nx.jpg",
                    path + "py.jpg", path + "ny.jpg",
                    path + "pz.jpg", path + "nz.jpg"
                ];

                textureCube = new THREE.CubeTextureLoader().load( urls );
                reflectMaterial = new THREE.MeshPhongMaterial( { color: 0xe4e4e4, envMap: textureCube, side: THREE.DoubleSide } );

                //AddAxisArrowHelper(scene);

				// texture

				var manager = new THREE.LoadingManager();
				manager.onProgress = function ( item, loaded, total ) {

					console.log( item, loaded, total );

				};

				// model

				var onProgress = function ( xhr ) {
					if ( xhr.lengthComputable ) {
						var percentComplete = xhr.loaded / xhr.total * 100;
						console.log( Math.round(percentComplete, 2) + '% downloaded' );
					}
				};

				var onError = function ( xhr ) {
				};

				//var loader = new THREE.OBJLoader( manager );
                //var loader = new THREE.PLYLoader();
                var material = new THREE.MeshPhongMaterial( { color: 0xAAAAAA, specular: 0x111111, shininess: 200 } );
                var loader = new THREE.STLLoader();
				//loader.load( 'obj/male02/male02.obj', function ( object ) {
                loader.load( 'obj/test/test123.stl', function ( geometry ){
                //loader.load( 'http://localhost:1337', function ( geometry ) {
                    onClickUpdateModel(geometry);
				}, onProgress, onError );

				//

				renderer = new THREE.WebGLRenderer({
                    antialias: true,
                    alpha: true
				});
                this.renderer.setClearColor(0x000000, 0);
				renderer.setPixelRatio( window.devicePixelRatio );
				renderer.setSize( 1280,811 );
				container.appendChild( renderer.domElement );

                orbitControls = new THREE.OrbitControls( camera, renderer.domElement );
                orbitControls.minDistance = 50;
                orbitControls.maxDistance = 1000;
                orbitControls.maxPolarAngle = Math.PI;

				//document.addEventListener( 'mousemove', onDocumentMouseMove, false );

				//

				//window.addEventListener( 'resize', onWindowResize, false );

			}

			function onWindowResize() {

			    var width = 800;
			    var height = 600;
				windowHalfX = window.innerWidth / 2;
				windowHalfY = window.innerHeight / 2;

				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();

				renderer.setSize( window.innerWidth, window.innerHeight );

			}

			function onDocumentMouseMove( event ) {

				mouseX = ( event.clientX - windowHalfX ) / 2;
				mouseY = ( event.clientY - windowHalfY ) / 2;

			}

			//

			function animate() {

				requestAnimationFrame( animate );
				render();
			}

			function update()
			{
			    var i = 0;

			    for(i = 0; i < modelArray.length; i++)
				{
                    var modelColor = parseInt("0x" + menuObj["模型颜色" + (i + 1)].slice(1));
                    //if(lastModelColor != modelColor)
                    {
                        var material = new THREE.MeshPhongMaterial( { color: modelColor, specular: 0x111111, shininess: 200 } );
                        modelArray[i].material = reflectMaterial;
                        lastModelColor = modelColor;
                    }
				}

                axisHelper.visible = menuObj["显示坐标轴"];
                xzPlane.visible = menuObj["显示xz平面"];
                xyPlane.visible = menuObj["显示xy平面"];
                yzPlane.visible = menuObj["显示yz平面"];
			}
			function render() {


			    update();
				//camera.position.x += ( mouseX - camera.position.x ) * .05;
				//camera.position.y += ( - mouseY - camera.position.y ) * .05;

				//camera.lookAt( scene.position );
				renderer.render( scene, camera );
			}

		</script>

	</body>
</html>
