<!DOCTYPE html>
<html lang="en">
	<head>
		<title>诺普信息技术</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        <meta http-equiv="Access-Control-Allow-Origin" content="*">
		<link href="https://fonts.googleapis.com/css?family=Electrolize:400" rel="stylesheet" type="text/css">
		<script async="" src="//www.google-analytics.com/analytics.js"></script>
		<script type="text/javascript" src="./js/jquery-ui-1.10.4.custom/js/jquery-1.10.2.js"></script>
		<script type="text/javascript" src="./js/jquery-ui-1.10.4.custom/js/jquery-ui-1.10.4.custom.min.js"></script>
		<script type="text/javascript" src="../dat.gui-master/build/dat.gui.js"></script>
		<link rel="stylesheet" href="../dat.gui-master/build/dat.gui.css" type="text/css">
		<link rel="stylesheet" href="style.css" type="text/css" media="screen">
		<link rel="stylesheet" href="./js/jquery-ui-1.10.4.custom/css_smoothness/jquery-ui.css">
		<script type="text/javascript" src="gui.js"></script>


		<script src="../build/three.js"></script>
		<script src="../build/three.module.js"></script>
		<script src="../dat.gui-master/tests/jquery.js"></script>

		<script src="../examples/js/controls/OrbitControls.js"></script>
		<script src="../examples/js/QuickHull.js"></script>
		<script src="../examples/js/geometries/ConvexGeometry.js"></script>
		<script src="../examples/js/Detector.js"></script>
		<script src="../examples/js/libs/stats.min.js"></script>
		<script src="../examples/js/loaders/STLLoader.js"></script>
		<script src="../examples/js/loaders/OBJLoader.js"></script>
		<script src="../examples/js/loaders/PLYLoader.js"></script>

		<script src="./utils/LoadGui.js"></script>
	</head>

	<body class="unselectable">
		<div id="content">
			<div class="centeredDiv">
				<div class="header">
					<div><img src="./images/EdgeWinLogo_2.png" width="159px" style="margin-left: 20px;"></div>
					<div class="menu">
						<ul class="menu">
							<li>
								<a href="/projects/" color="#ffffff">刀具种类</a>
							</li>
							<li>
								<a href="/shop/">技术秒杀</a>
							</li>
							<li>
								<a href="/blog">帮助</a>
							</li>
							<li>
								<input style="border:1px solid #ffffff" value="搜索">
							</li>
						</ul>
					</div>
					<div class="menu2">
						<ul class="menu2">
							<li>
								<a color="#ffffff">账单查询</a>
							</li>
							<li>
								<a>返回首页</a>
							</li>
							<li>
								<a>注册</a>
							</li>
							<li>
								<a>登录</a>
							</li>
							<li>
								<a>退出</a>
							</li>
						</ul>
					</div>
					<ul class="info">
						<li id="loginOrLogout" class="info"><a class="info" href="/shop/login.php">login</a></li>
						<li id="myAccount" class="info" style="display:none;"><a class="info" href="/shop/account.php">my account</a></li>
						<li id="cartLabel" class="info"><a class="info" href="/shop/shopping_cart.php">cart:</a>
							<span id="cartContents" style="font-size:9px">
						 0 items						 </span>
						</li>
					</ul>
				</div>
			</div>
			<div class="app">
				<!-- facebook like button stuff -->
				<div id="fb-root"></div>
				<!-- end facebook stuff -->
				<div class="appTitle">
					<div>
						<div class="appName" style="position: absolute;margin-left: 40px;margin-top: 0px;">钻头</div>
						<div class="appName2" style="position: absolute;margin-left: 50px;margin-top: 80px;">整体钻头</div>
						<div class="smallbutton" style="position: absolute;margin-left: 10px;margin-top: 120px;" onclick="Display3DModel()">概念设计图</div>
						<div class="smallbutton" style="position: absolute;margin-left: 110px;margin-top: 120px;" onclick="DisplayTuZhi()">工程制造图</div>

						<div class="smallbutton" style="position: absolute;margin-left: 10px;margin-top: 160px;width:200px;" onclick="OnClickHeadSearch()">整体钻头  搜索</div>
						<div class="smallbutton" style="position: absolute;margin-left: 10px;margin-top: 190px;width:200px;" onclick="OnClickParamDesign()">整体钻头  参数设计</div>
						<div class="smallbutton" style="position: absolute;margin-left: 10px;margin-top: 220px;width:200px;" onclick="OnClickHandleSearch()">刀柄搜索</div>
					</div>
				</div>
				<div id="canvas">
						<div id="gameCanvas" width="1440px" height="1080px"></div>
						<div id="divPdfView" class="pdfView" style="visibility: hidden">
							<embed id="pdfCtrl" src="./pdf/test1.pdf" type="application/pdf" width="1440px" height="630"></embed>
						</div>
				</div>

				<div id="toolBoxTuZhi" class="toolBox" style="visibility: hidden">
					<div class="section section_material">
						<div class="appLabel">二维工程图下载</div>
						<div class="button" onclick="">PDF</div>
						<div class="button" onclick="">DWG</div>
						<div class="button" onclick="">打包下载</div>
					</div>

					<div class="nervousLogo noSel">
						<img src="images/EdgeWinLogo_3.png">
					</div>
				</div>
				<div id="toolBox3D" class="toolBox2">
					<div class="section section_sculpt">
						<div class="appLabel">视图选择</div>
						<div class="panel">
							<div id="subdivide" class="imgButton" onclick="activateButton('mainView');"><a class="tooltipI"><img src="images/subdivideIcon_w.png"><div>俯视图</div></a></div>
							<div id="merge" class="imgButton" onclick="activateButton('topView');"><a class="tooltipI"><img src="images/mergeIcon_w.png"><div>俯视图</div></a></div>
							<div id="modify" class="imgButton" onclick="activateButton('leftView');"><a class="tooltipI"><img src="images/modifyIcon_w.png"><div>左视图</div></a></div>
						</div>
					</div>
					<div class="section section_jizhunxianshi">
						<div class="appLabel">基准显示</div>
						<div class="smallbutton" onclick="OnClickDisplayZuoBiaoZhou();">坐标轴</div>
						<div class="smallbutton" onclick="OnClickDisplayXZPlane();">xz平面</div>
						<div class="smallbutton" onclick="OnClickDisplayYZPlane()">yz平面</div>
						<div class="smallbutton" onclick="OnClickDisplayXYPlane()">xy平面</div>
					</div>
					<div class="section section_tuceng">
						<div class="appLabel">涂层</div>
						<div class="smallbutton" onclick="">金</div>
						<div class="smallbutton" onclick="">银</div>
						<div class="smallbutton" onclick="">合金</div>
					</div>
					<div class="section section_material">
						<div class="appLabel">三维和图纸下载</div>
						<div class="button" onclick="">STP</div>
						<div class="button" onclick="OnClickDownloadObj();">OBJ</div>
						<div class="button" onclick="">打包下载</div>
					</div>

					<div class="nervousLogo noSel">
						<img src="images/EdgeWinLogo_3.png">
					</div>
				</div>
			</div>
		</div>

		<script>
			function AddAxisArrowHelper(scene)
			{
                var Xdir = new THREE.Vector3(1,0,0);
                var Ydir = new THREE.Vector3(0,1,0);
                var Zdir = new THREE.Vector3(0,0,1);

				//确定原点，箭头长度，和箭头颜色，三个箭头同一设置
                var origin = new THREE.Vector3(0,0,0);
                var length = 200;
                var color = 0xffff00;

				//建立三个方向上箭头辅助
                var YarrowHelper = new THREE.ArrowHelper(Ydir,origin,length,0xff0000);
                var ZarrowHelper = new THREE.ArrowHelper(Zdir,origin,length,0x0000ff);
                var XarrowHelper = new THREE.ArrowHelper(Xdir,origin,length,0x00ff00);
				//把箭头辅助加入 场景
                scene.add(YarrowHelper);
                scene.add(ZarrowHelper);
                scene.add(XarrowHelper);
			}

            if ( ! Detector.webgl ) Detector.addGetWebGLMessage();

			var container;
			var modelArray = new Array();
			var camera, scene, renderer;
			var orbitControls;
			var modelNode;
			var xzPlane,xyPlane,yzPlane;
			var axisHelper;
			var lastModelColor;
            var menuObj = {};
            var textureCube;
            var reflectMaterial;
			var m_globalGui;
			var mouseX = 0, mouseY = 0;

			var windowHalfX = window.innerWidth / 2;
			var windowHalfY = window.innerHeight / 2;

            function OnClickDisplayZuoBiaoZhou()
            {
                menuObj["显示坐标轴"] = !menuObj["显示坐标轴"];
            }
            function OnClickDisplayXYPlane()
			{
                menuObj["显示xy平面"] = !menuObj["显示xy平面"];
			}
            function OnClickDisplayYZPlane()
            {
                menuObj["显示yz平面"] = !menuObj["显示yz平面"];
            }
            function OnClickDisplayXZPlane()
            {
                menuObj["显示xz平面"] = !menuObj["显示xz平面"];
            }
            function OnClickUpdateModel()
			{
			    menuObj["更新模型"]();
			}
			function CloseAllTab()
			{
			    LoadGUIByConfig();

			}
			function OnClickDownloadObj()
			{

			}
			function OnClickDownloadStp()
			{

			}
			function OnClickDownloadAllModel()
			{

			}
			function OnClickDownloadPdf()
			{

			}
			function IsAccessibleToDownload()
			{

			}

            function onClickUpdateModel(geometry)
            {
                var material = null;
                if (geometry.hasColors) {
                    material = new THREE.MeshPhongMaterial({ opacity: geometry.alpha, vertexColors: THREE.VertexColors });
                }
                else
                {
                    material = new THREE.MeshPhongMaterial( { color: 0xAAAAAA, specular: 0x111111, shininess: 200 } );
                }

                var mesh = new THREE.Mesh( geometry, material );

                mesh.position.set( 0, 0, 0);
                mesh.rotation.set( - Math.PI / 2, 0, 0 );
                mesh.scale.set( 1,1,1 );

                mesh.castShadow = true;
                mesh.receiveShadow = true;

                //object.position.y = - 95;
                scene.add( mesh );
                modelArray.push(mesh);

                modelNode = mesh;
            }
            function removeAllSceneModel()
			{
			    var i = 0;
			    for(i = 0; i < modelArray.length; i++)
				{
				    scene.remove(modelArray[i]);
				}

				modelArray = new Array();
			}
            function onCallBack(response)
			{
                var onProgress = function ( xhr ) {

                };

                var onError = function ( xhr ) {
                };

                removeAllSceneModel();

                var jsonObj = eval('(' + response + ')');
                var modelFileList = jsonObj.ModelFileList;
                var pdfFile = jsonObj.PdfList;
                var pdfCtrl = document.getElementById( 'pdfCtrl' );
                pdfCtrl.src = 'http://localhost:1337/' + pdfFile;

                var i = 0;
                for(i = 0; i < modelFileList.length; i++)
				{
				    var requestURL = 'http://localhost:1337' + modelFileList[i].URL;
                    var modelColor = modelFileList[i].DefaultColor;
					//var a = "#" + modelColor;
					//menuObj["模型颜色" + (i + 1)] = "#" + modelColor;

                    var loader = new THREE.STLLoader();
                    loader.load(requestURL, function ( geometry ){
                        onClickUpdateModel(geometry);
                    },onProgress,onError);
				}
			}

            LoadDesignGUI("config/config.json",onCallBack,menuObj,Display3DModel,DisplayTuZhi);

			init();
			animate();

			function init() {

				container = document.getElementById( 'gameCanvas' );
				//container.width = 800;
				//container.height = 600;
				//document.body.appendChild( container );

				camera = new THREE.PerspectiveCamera( 45, 800 / 600, 1, 2000 );
				camera.position.z = 250;

				// scene

				scene = new THREE.Scene();

				var ambientLight = new THREE.AmbientLight( 0xcccccc, 0.4 );
				scene.add( ambientLight );

				var pointLight = new THREE.PointLight( 0xffffff, 0.8 );
				camera.add( pointLight );
				scene.add( camera );

                axisHelper = new THREE.AxisHelper(200);
                axisHelper.material.depthTest = false;
                scene.add(axisHelper);

                var planeGeometry = new THREE.PlaneGeometry(60,40,10,10);
                //平面材质，基本材质是渲染不出阴影的，下面的材质可以，仅仅指定颜色
                var planeMaterial = new THREE.MeshLambertMaterial({color:0xff00dd});
                planeMaterial.wireframe = true;
                //以给定的尺寸和材质构建一个平面
                xzPlane = new THREE.Mesh(planeGeometry,planeMaterial);
                //指定平面的旋转角度，方便观察
                xzPlane.rotation.x = -0.5 * Math.PI;
                //平面的位置
                xzPlane.position.x = 0;
                xzPlane.position.y = 0;
                xzPlane.position.z = 0;
                //平面加入场景
                scene.add(xzPlane);

                planeMaterial = new THREE.MeshLambertMaterial({color:0x00ffdd});
                planeMaterial.wireframe = true;
                yzPlane = new THREE.Mesh(planeGeometry,planeMaterial);
                yzPlane.rotation.y = -0.5 * Math.PI;
                yzPlane.position.x = 0;
                yzPlane.position.y = 0;
                yzPlane.position.z = 0;
                scene.add(yzPlane);

                planeMaterial = new THREE.MeshLambertMaterial({color:0xffdd00});
                planeMaterial.wireframe = true;
                xyPlane = new THREE.Mesh(planeGeometry,planeMaterial);
                //指定平面的旋转角度，方便观察
                xyPlane.rotation.z = -0.5 * Math.PI;
                //平面的位置
                xyPlane.position.x = 0;
                xyPlane.position.y = 0;
                xyPlane.position.z = 0;
                //平面加入场景
                scene.add(xyPlane);

                var path = "../examples/textures/cube/skybox/";
                var urls = [
                    path + "px.jpg", path + "nx.jpg",
                    path + "py.jpg", path + "ny.jpg",
                    path + "pz.jpg", path + "nz.jpg"
                ];

                textureCube = new THREE.CubeTextureLoader().load( urls );
                reflectMaterial = new THREE.MeshPhongMaterial( { color: 0xe4e4e4, envMap: textureCube, side: THREE.DoubleSide } );

                //AddAxisArrowHelper(scene);

				// texture

				var manager = new THREE.LoadingManager();
				manager.onProgress = function ( item, loaded, total ) {

					console.log( item, loaded, total );

				};

				// model

				var onProgress = function ( xhr ) {
					if ( xhr.lengthComputable ) {
						var percentComplete = xhr.loaded / xhr.total * 100;
						console.log( Math.round(percentComplete, 2) + '% downloaded' );
					}
				};

				var onError = function ( xhr ) {
				};

				//var loader = new THREE.OBJLoader( manager );
                //var loader = new THREE.PLYLoader();
                var material = new THREE.MeshPhongMaterial( { color: 0xAAAAAA, specular: 0x111111, shininess: 200 } );
                var loader = new THREE.STLLoader();
				//loader.load( 'obj/male02/male02.obj', function ( object ) {
                loader.load( 'obj/test/test123.stl', function ( geometry ){
                //loader.load( 'http://localhost:1337', function ( geometry ) {
                    onClickUpdateModel(geometry);
				}, onProgress, onError );

				//

				renderer = new THREE.WebGLRenderer({
                    antialias: true,
                    alpha: true
				});
                this.renderer.setClearColor(0x000000, 0);
				renderer.setPixelRatio( window.devicePixelRatio );
				renderer.setSize( 1280,811 );
				container.appendChild( renderer.domElement );

                orbitControls = new THREE.OrbitControls( camera, renderer.domElement );
                orbitControls.minDistance = 50;
                orbitControls.maxDistance = 1000;
                orbitControls.maxPolarAngle = Math.PI;

				//document.addEventListener( 'mousemove', onDocumentMouseMove, false );

				//

				//window.addEventListener( 'resize', onWindowResize, false );

			}

			function onWindowResize() {

			    var width = 800;
			    var height = 600;
				windowHalfX = window.innerWidth / 2;
				windowHalfY = window.innerHeight / 2;

				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();

				renderer.setSize( window.innerWidth, window.innerHeight );

			}

			function onDocumentMouseMove( event ) {

				mouseX = ( event.clientX - windowHalfX ) / 2;
				mouseY = ( event.clientY - windowHalfY ) / 2;

			}

			//

			function animate() {

				requestAnimationFrame( animate );
				render();
			}

			function update()
			{
			    var i = 0;

			    for(i = 0; i < modelArray.length; i++)
				{
					modelArray[i].material = reflectMaterial;
				}

                axisHelper.visible = menuObj["显示坐标轴"];
                xzPlane.visible = menuObj["显示xz平面"];
                xyPlane.visible = menuObj["显示xy平面"];
                yzPlane.visible = menuObj["显示yz平面"];
			}
			function render() {


			    update();
				//camera.position.x += ( mouseX - camera.position.x ) * .05;
				//camera.position.y += ( - mouseY - camera.position.y ) * .05;

				//camera.lookAt( scene.position );
				renderer.render( scene, camera );
			}

		</script>

	</body>
</html>
