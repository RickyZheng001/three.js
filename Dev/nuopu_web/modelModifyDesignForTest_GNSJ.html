<!DOCTYPE html>
<html lang="en">
	<head>
		<title>上海锘璞金属切削技术有限公司</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        <meta http-equiv="Access-Control-Allow-Origin" content="*">
		<meta http-equiv="pragma" content="no-cache">
		<meta http-equiv="cache-control" content="no-cache">
		<meta http-equiv="expires" content="0">
		<link href="https://fonts.googleapis.com/css?family=Electrolize:400" rel="stylesheet" type="text/css">
		<script async="" src="//www.google-analytics.com/analytics.js"></script>
		<script type="text/javascript" src="./js/jquery-ui-1.10.4.custom/js/jquery-1.10.2.js"></script>
		<script type="text/javascript" src="./js/jquery-ui-1.10.4.custom/js/jquery-ui-1.10.4.custom.min.js"></script>
		<script type="text/javascript" src="../dat.gui-master/build/dat.gui.js"></script>
		<link rel="stylesheet" href="../dat.gui-master/build/dat.gui.css" type="text/css">
		<link rel="stylesheet" href="style.css" type="text/css" media="screen">
		<link rel="stylesheet" href="./js/jquery-ui-1.10.4.custom/css_smoothness/jquery-ui.css">
		<link rel="stylesheet" href="right_menu.css">
		<script type="text/javascript" src="gui.js"></script>
		<script type="text/javascript" src="config.js"></script>

		<script src="../build/three.js"></script>
		<script src="../build/three.module.js"></script>
		<script src="../dat.gui-master/tests/jquery.js"></script>

		<script src="../examples/js/controls/OrbitControls.js"></script>
		<script src="../examples/js/QuickHull.js"></script>
		<script src="../examples/js/geometries/ConvexGeometry.js"></script>
		<script src="../examples/js/Detector.js"></script>
		<script src="../examples/js/libs/stats.min.js"></script>
		<script src="../examples/js/loaders/STLLoader.js"></script>
		<script src="../examples/js/loaders/OBJLoader.js"></script>
		<script src="../examples/js/loaders/PLYLoader.js"></script>

		<script src="./utils/LoadGui.js"></script>
		<script src="./js/GlobalDefine.js"></script>
	</head>

	<body class="unselectable">
		<div id="content">
			<div class="centeredDiv">
				<div class="header">
					<div><img src="./images/EdgeWinLogo_2.png" width="159px" style="margin-left: 20px;"></div>
					<div><img src="./images/GNSJ_SearchLogoTest.png" width="159px" style="position: absolute;margin-left: 31%;margin-top:-7px;width: 401px;height:66px; "></div>

					<div class="menu2">
						<ul class="menu2">
							<li>
								<a color="#ffffff">返回首页</a>
							</li>
						</ul>
					</div>
					<ul class="info">
						<li id="loginOrLogout" class="info"><a class="info" href="/shop/login.php">login</a></li>
						<li id="myAccount" class="info" style="display:none;"><a class="info" href="/shop/account.php">my account</a></li>
						<li id="cartLabel" class="info"><a class="info" href="/shop/shopping_cart.php">cart:</a>
							<span id="cartContents" style="font-size:9px">
						 0 items						 </span>
						</li>
					</ul>
				</div>
			</div>
			<div class="app">
				<!-- facebook like button stuff -->
				<div id="fb-root"></div>
				<!-- end facebook stuff -->
				<div class="appTitle">
					<div>
						<div class="appName" style="position: absolute;margin-left: 40px;margin-top: 0px;">钻头</div>
						<div class="appName2" style="position: absolute;margin-left: 50px;margin-top: 80px;">整体钻头</div>
						<div class="smallbutton" style="position: absolute;margin-left: 10px;margin-top: 120px;width:100px;" onclick="Update3DModelByComboBox()">更新显示三维</div>
						<select id="SanWeiComboBox" style="position: absolute;margin-left: 130px;margin-top: 122px;width:80px;" onchange="">
							<option value ="0">刀具</option>
							<option value ="1">刀柄</option>
							<option value ="2">延长杆</option>
							<option value ="3">装配</option>
						</select>
						<div class="smallbutton" style="position: absolute;margin-left: 10px;margin-top: 150px;width:100px;" onclick="UpdateTuZhiByComboBox()">更新显示二维</div>
						<select id="ErWeiComboBox" style="position: absolute;margin-left: 130px;margin-top: 152px;width:80px;" onchange="">
							<option value ="0">刀具</option>
							<option value ="1">刀柄</option>
							<option value ="2">延长杆</option>
							<option value ="3">装配</option>
						</select>

						<HR width="80%" color=#bbbbbb SIZE=2 style="position: absolute;margin-top: 185px;margin-left: 10px;"/>

						<div class="smallbutton" style="position: absolute;margin-left: 10px;margin-top: 200px;cursor:default;">夹持结构 </div>

						<select id="YanChangGanComboBox" style="position: absolute;margin-left: 100px;margin-top: 202px;width:116px;" onchange="OnJiaChiJieGouSelectionChanged()">
							<option value ="1">刀柄+延长杆+刀具</option>
						</select>

						<HR width="80%" color=#bbbbbb SIZE=2 style="position: absolute;margin-top: 235px;margin-left: 10px;"/>

						<div class="smallbutton" style="position: absolute;margin-left: 10px;margin-top: 250px;width:200px;" onclick="OnClickZuanTouSearch()">整体钻头&nbsp;&nbsp;&nbsp;&nbsp;Search</div>
						<div class="smallbutton" style="position: absolute;margin-left: 10px;margin-top: 280px;width:200px;" onclick="OnClickParamDesign()">整体钻头&nbsp;&nbsp;&nbsp;&nbsp;Design</div>
						<div class="smallbutton" style="position: absolute;margin-left: 10px;margin-top: 310px;width:120px;" onclick="">刀具夹持长度更新</div>
						<input style="position: absolute;margin-left: 150px;margin-top: 310px;width:30px;" type="text" name="jiaChiLength" />
						<div style="position: absolute;margin-left: 190px;margin-top: 310px;width:40px;">mm</div>
						<HR width="80%" color=#bbbbbb SIZE=2 style="position: absolute;margin-top: 345px;margin-left: 10px;"/>
						<div class="smallbutton" style="position: absolute;margin-left: 10px;margin-top: 360px;width:200px;" onclick="OnClickHandleSearch()">刀柄&nbsp;&nbsp;&nbsp;&nbsp;Search</div>
						<div class="smallbutton" style="position: absolute;margin-left: 10px;margin-top: 390px;width:200px;" onclick="OnClickParamDesign_Handle()">刀柄&nbsp;&nbsp;&nbsp;&nbsp;Design</div>

						<HR width="80%" color=#bbbbbb SIZE=2 style="position: absolute;margin-top: 425px;margin-left: 10px;"/>

						<div id="YanChangGanBtn" class="smallbutton" style="position: absolute;margin-left: 10px;margin-top: 440px;width:200px;" onclick="OnClickYanChangGanSearch()">延长杆&nbsp;&nbsp;&nbsp;&nbsp;Search</div>
						<div id="YanChangGanBtn2" class="smallbutton" style="position: absolute;margin-left: 10px;margin-top: 470px;width:200px;" onclick="OnClickParamDesign_YanChangGan()">延长杆&nbsp;&nbsp;&nbsp;&nbsp;Design</div>
						<div class="smallbutton" style="position: absolute;margin-left: 10px;margin-top: 500px;width:120px;" onclick="">延长杆夹持长度更新</div>
						<input style="position: absolute;margin-left: 150px;margin-top: 500px;width:30px;" type="text" name="yanChangGanLength" />
						<div style="position: absolute;margin-left: 190px;margin-top: 500px;width:40px;">mm</div>

						<HR width="80%" color=#bbbbbb SIZE=2 style="position: absolute;margin-top: 535px;margin-left: 10px;"/>

						<div class="smallbutton" style="position: absolute;margin-left: 10px;margin-top: 550px;width:200px;" onclick="OnClickJiShuYaoQiu()">技术条件</div>
						<div class="smallbutton" style="position: absolute;margin-left: 10px;margin-top: 580px;width:200px;" onclick="OnClickTuZhiMuBan()">图纸模板</div>
					</div>
				</div>
				<div id="canvas">
					<div id="gameCanvas" width="1920px" height="1080px"></div>
					<div id="divPdfView" class="pdfView" style="visibility: hidden">
						<embed id="pdfCtrl" src="./pdf/test1.pdf" type="application/pdf" width="1440px" height="600"></embed>
					</div>
					<div class="JiShu">

					</div>
					<canvas id="myCanvas" width="500" height="150" style="position: absolute;left: 40%;top: 40px;visibility: hidden">Your browser does not have support for canvas.</canvas>
                    <div id="SearchTable" style="visibility: hidden">
                        <table class="editableTable" border="0" style="position: absolute;left: 300px;top: 200px;overflow:scroll;width: 800px;">
                            <tr class="editable simpleInput">
                                <th style="width: 60px;">序号</th>
                                <th style="width: 60px;">名称</th>
                                <th style="width: 60px;">总长</th>
                                <th style="width: 60px;">柄部直径</th>
                                <th style="width: 60px;">直径</th>
                                <th style="width: 60px;">
                                    <div class="closebutton" style="position: absolute;width: 30px;margin-left: 14px;margin-top: -9px;padding-left: 0px;padding-top: 0px;" onclick="HideSearchResultPanel()">关闭</div>
                                </th>
                            </tr>
                            <tr class="editable simpleInput">
                                <td>1</td>
                                <td>钻头</td>
                                <td>237</td>
                                <td>10</td>
                                <td>10</td>
                                <td>
                                    <div class="smallbutton" style="position: absolute;width: 30px;margin-left: 14px;margin-top: -9px;padding-left: 0px;padding-top: 0px;" onclick="DisplayTuZhi()">更新</div>
                                </td>
                            </tr>
                            <tr class="editable simpleInput">
                                <td>2</td>
                                <td>钻头2</td>
                                <td>237</td>
                                <td>10</td>
                                <td>10</td>
                                <td>
                                    <div class="smallbutton" style="position: absolute;width: 30px;margin-left: 14px;margin-top: -9px;padding-left: 0px;padding-top: 0px;" onclick="DisplayTuZhi()">更新</div>
                                </td>
                            </tr>
                            <tr class="editable simpleInput">
                                <td>2</td>
                                <td>钻头3</td>
                                <td>237</td>
                                <td>10</td>
                                <td>10</td>
                                <td>
                                    <div class="smallbutton" style="position: absolute;width: 30px;margin-left: 14px;margin-top: -9px;padding-left: 0px;padding-top: 0px;" onclick="DisplayTuZhi()">更新</div>
                                </td>
                            </tr>
                            <tr class="editable simpleInput">
                                <td>2</td>
                                <td>钻头4</td>
                                <td>237</td>
                                <td>10</td>
                                <td>10</td>
                                <td>
                                    <div class="smallbutton" style="position: absolute;width: 30px;margin-left: 14px;margin-top: -9px;padding-left: 0px;padding-top: 0px;" onclick="DisplayTuZhi()">更新</div>
                                </td>
                            </tr>
                            <tr class="editable simpleInput">
                                <td>2</td>
                                <td>钻头5</td>
                                <td>237</td>
                                <td>10</td>
                                <td>10</td>
                                <td>
                                    <div class="smallbutton" style="position: absolute;width: 30px;margin-left: 14px;margin-top: -9px;padding-left: 0px;padding-top: 0px;" onclick="DisplayTuZhi()">更新</div>
                                </td>
                            </tr>
					</table>
				</div>
					<div id="divParamList" style="position: absolute;z-index: 10;left: 320px;bottom: 220px;width: 400px;">
					</div>
					<div id="techRequest" style="position: absolute;z-index: 10;left: 520px;bottom: 220px;width: 300px;">
					</div>

				<div id="ModelGenerateProgressBar" style="visibility: hidden;position: absolute" left="200px" top="200px" ></div>

				<div id="toolBoxTuZhi" class="toolBox" style="visibility: hidden">
					<div class="section section_material">
						<div class="appLabel">二维工程图下载</div>
						<div class="button" onclick="">PDF</div>
						<div class="button" onclick="">DWG</div>
						<div class="button" onclick="">打包下载</div>
					</div>

					<div class="nervousLogo noSel">
						<img src="images/EdgeWinLogo_3.png">
					</div>
				</div>
					<div id="toolBox3D">
						<div class="section section_sculpt">
							<div class="appLabel">
								<table class="tab">
									<tr>
										<td class="right_td">刀具</td><td class="right_td">Design</td>
									</tr>
									<tr>
										<td class="right_td">刀柄</td><td class="right_td">Search</td>
									</tr>
									<tr>
										<td class="right_td">延长杆</td><td class="right_td">Search</td>
									</tr>
									<tr>
										<td class="right_td"></td><td class="right_td"></td>
									</tr>
									<tr>
										<td class="right_td"></td><td class="right_td"></td>
									</tr>
									<tr>
										<td class="right_td"></td><td class="right_td"></td>
									</tr>
									<tr>
										<td class="right_td"></td><td class="right_td"></td>
									</tr>
								</table>
							</div>
							<div  ><img style="margin-top:10px;position:absolute;border: #009fd7" src="images/bji.png"
										height="184" width="169	"/></div>
							<div class="panel" style="width:170px;margin-top: 10px;position:absolute;z-index: 1"><div class="smallbutton" style="position:absolute;left:0px;top:-30px;" onclick="QueryServerState()">Check</div><div class="smallbutton" style="position:absolute;left:84px;top:-30px;" onclick="Help()">Help</div>

								<div class="right_t" onclick="activateButton('zhouCeView');"></div>
								<div class="right_t" onclick="activateButton('rightView');"></div>
								<div class="right_t" onclick="OnClickDisplayZuoBiaoZhou();"></div>
								<div class="right_t" onclick="activateButton('mainView');"></div>
								<div class="right_t" onclick="activateButton('topView');"></div>
								<div class="right_t" onclick="OnClickDisplayXZPlane();"></div>
								<div class="right_t" onclick="activateButton('backView');"></div>
								<div class="right_t" onclick="activateButton('bottomView');"></div>
								<div class="right_t" onclick="OnClickDisplayYZPlane()"></div>
								<div class="right_t" onclick="activateButton('leftView');"></div>
								<div class="right_t"></div>
								<div class="right_t" onclick="OnClickDisplayXYPlane()"></div>


								<div id="button" style="margin-top: 35px">下载</div>
							</div>
							<div class="nervousLogo noSel" style="position: absolute;right: 615px;bottom: -377px">
								<img src="images/EdgeWinLogo_3.png">
							</div>

						</div>
					</div>
			</div>
		</div>

		<script>
            //initBindGridEvent();

			var progressBar = {};
            var progressBarPercent = 0;
            var contextProgress = null;
            var progressTimer = null;
            progressBar.total_width = 300;
            progressBar.total_height = 34;
            progressBar.initial_x = 20;
            progressBar.initial_y = 20;
            progressBar.radius = progressBar.total_height * 0.5;
            window.onload = function() {
                var elem = document.getElementById('myCanvas');
                if (!elem || !elem.getContext) {
                    return;
                }

                contextProgress = elem.getContext('2d');
                if (!contextProgress) {
                    return;
                }

                // set font
                contextProgress.font = "16px Verdana";

                // Blue gradient for progress bar
                var progress_lingrad = contextProgress.createLinearGradient(0,progressBar.initial_y + progressBar.total_height,0,0);
                progress_lingrad.addColorStop(0, '#4DA4F3');
                progress_lingrad.addColorStop(0.4, '#ADD9FF');
                progress_lingrad.addColorStop(1, '#9ED1FF');
                contextProgress.fillStyle = progress_lingrad;

                updateProgress(0);
            }

            function onUpdateProgress()
			{
                progressBarPercent += 0.003;
			    updateProgress(progressBarPercent);
			}
            function updateProgress(progress)
			{
                if(progress >= 0.99)
				{
				    if(m_globalGenerateModelStep == 1)
					{
                        m_globalGenerateModelStep = 2;
                        progressBarPercent = 0;
					}
					else if(m_globalGenerateModelStep == 2)
					{
                        progress = 0.99;
					}

                }

                var x = progress * progressBar.total_width;
                // Clear everything before drawing
                contextProgress.clearRect(progressBar.initial_x - 5,progressBar.initial_y - 5,progressBar.total_width + 15,progressBar.total_height + 15);
                progressLayerRect(contextProgress, progressBar.initial_x, progressBar.initial_y, progressBar.total_width, progressBar.total_height, progressBar.radius);
                progressBarRect(contextProgress, progressBar.initial_x, progressBar.initial_y, x, progressBar.total_height, progressBar.radius, progressBar.total_width);
                progressText(contextProgress, progressBar.initial_x, progressBar.initial_y, x, progressBar.total_height, progressBar.radius, progressBar.total_width );
            }

            /**
             * Draws a rounded rectangle.
             * @param {CanvasContext} ctx
             * @param {Number} x The top left x coordinate
             * @param {Number} y The top left y coordinate
             * @param {Number} width The width of the rectangle
             * @param {Number} height The height of the rectangle
             * @param {Number} radius The corner radius;
             */
            function roundRect(ctx, x, y, width, height, radius) {
                ctx.beginPath();
                ctx.moveTo(x + radius, y);
                ctx.lineTo(x + width - radius, y);
                ctx.arc(x+width-radius, y+radius, radius, -Math.PI/2, Math.PI/2, false);
                ctx.lineTo(x + radius, y + height);
                ctx.arc(x+radius, y+radius, radius, Math.PI/2, 3*Math.PI/2, false);
                ctx.closePath();
                ctx.fill();
            }

            /**
             * Draws a rounded rectangle.
             * @param {CanvasContext} ctx
             * @param {Number} x The top left x coordinate
             * @param {Number} y The top left y coordinate
             * @param {Number} width The width of the rectangle
             * @param {Number} height The height of the rectangle
             * @param {Number} radius The corner radius;
             */
            function roundInsetRect(ctx, x, y, width, height, radius) {
                ctx.beginPath();
                // Draw huge anti-clockwise box
                ctx.moveTo(1000, 1000);
                ctx.lineTo(1000, -1000);
                ctx.lineTo(-1000, -1000);
                ctx.lineTo(-1000, 1000);
                ctx.lineTo(1000, 1000);
                ctx.moveTo(x + radius, y);
                ctx.lineTo(x + width - radius, y);
                ctx.arc(x+width-radius, y+radius, radius, -Math.PI/2, Math.PI/2, false);
                ctx.lineTo(x + radius, y + height);
                ctx.arc(x+radius, y+radius, radius, Math.PI/2, 3*Math.PI/2, false);
                ctx.closePath();
                ctx.fill();
            }

            function progressLayerRect(ctx, x, y, width, height, radius) {
                ctx.save();
                // Set shadows to make some depth
                ctx.shadowOffsetX = 2;
                ctx.shadowOffsetY = 2;
                ctx.shadowBlur = 5;
                ctx.shadowColor = '#666';

                // Create initial grey layer
                ctx.fillStyle = 'rgba(189,189,189,1)';
                roundRect(ctx, x, y, width, height, radius);

                // Overlay with gradient
                ctx.shadowColor = 'rgba(0,0,0,0)'
                var lingrad = ctx.createLinearGradient(0,y+height,0,0);
                lingrad.addColorStop(0, 'rgba(255,255,255, 0.1)');
                lingrad.addColorStop(0.4, 'rgba(255,255,255, 0.7)');
                lingrad.addColorStop(1, 'rgba(255,255,255,0.4)');
                ctx.fillStyle = lingrad;
                roundRect(ctx, x, y, width, height, radius);

                ctx.fillStyle = 'white';
                //roundInsetRect(ctx, x, y, width, height, radius);

                ctx.restore();
            }

            /**
             * Draws a half-rounded progress bar to properly fill rounded under-layer
             * @param {CanvasContext} ctx
             * @param {Number} x The top left x coordinate
             * @param {Number} y The top left y coordinate
             * @param {Number} width The width of the bar
             * @param {Number} height The height of the bar
             * @param {Number} radius The corner radius;
             * @param {Number} max The under-layer total width;
             */
            function progressBarRect(ctx, x, y, width, height, radius, max) {
                // var to store offset for proper filling when inside rounded area
                var offset = 0;
                ctx.beginPath();
                if (width<radius) {
                    offset = radius - Math.sqrt(Math.pow(radius,2)-Math.pow((radius-width),2));
                    ctx.moveTo(x + width, y+offset);
                    ctx.lineTo(x + width, y+height-offset);
                    ctx.arc(x + radius, y + radius, radius, Math.PI - Math.acos((radius - width) / radius), Math.PI + Math.acos((radius - width) / radius), false);
                }
                else if (width+radius>max) {
                    offset = radius - Math.sqrt(Math.pow(radius,2)-Math.pow((radius - (max-width)),2));
                    ctx.moveTo(x + radius, y);
                    ctx.lineTo(x + width, y);
                    ctx.arc(x+max-radius, y + radius, radius, -Math.PI/2, -Math.acos((radius - (max-width)) / radius), false);
                    ctx.lineTo(x + width, y+height-offset);
                    ctx.arc(x+max-radius, y + radius, radius, Math.acos((radius - (max-width)) / radius), Math.PI/2, false);
                    ctx.lineTo(x + radius, y + height);
                    ctx.arc(x+radius, y+radius, radius, Math.PI/2, 3*Math.PI/2, false);
                }
                else {
                    ctx.moveTo(x + radius, y);
                    ctx.lineTo(x + width, y);
                    ctx.lineTo(x + width, y + height);
                    ctx.lineTo(x + radius, y + height);
                    ctx.arc(x+radius, y+radius, radius, Math.PI/2, 3*Math.PI/2, false);
                }
                ctx.closePath();
                ctx.fill();

                // draw progress bar right border shadow
                if (width<max-1) {
                    ctx.save();
                    ctx.shadowOffsetX = 1;
                    ctx.shadowBlur = 1;
                    ctx.shadowColor = '#666';
                    if (width+radius>max)
                        offset = offset+1;
                    ctx.fillRect(x +width,y+offset,1,progressBar.total_height-offset*2);
                    ctx.restore();
                }
            }

            /**
             * Draws properly-positioned progress bar percent text
             * @param {CanvasContext} ctx
             * @param {Number} x The top left x coordinate
             * @param {Number} y The top left y coordinate
             * @param {Number} width The width of the bar
             * @param {Number} height The height of the bar
             * @param {Number} radius The corner radius;
             * @param {Number} max The under-layer total width;
             */
            function progressText(ctx, x, y, width, height, radius, max) {
                ctx.save();
                ctx.fillStyle = 'white';
                var text = Math.floor(width/max*100)+"%";

                if(m_globalGenerateModelStep == 1)
                {
                    text = "生成3D模型中... " + text;
                }
                else if(m_globalGenerateModelStep == 2)
                {
                    text = "生成pdf中..." + text;
                }

                var text_width = ctx.measureText(text).width;
                var text_x = x + (progressBar.total_width - text_width) * 0.5;

				ctx.fillText(text, text_x, y+22);
                ctx.restore();
            }

            function AddAxisArrowHelper(scene)
			{
                var Xdir = new THREE.Vector3(1,0,0);
                var Ydir = new THREE.Vector3(0,1,0);
                var Zdir = new THREE.Vector3(0,0,1);

				//确定原点，箭头长度，和箭头颜色，三个箭头同一设置
                var origin = new THREE.Vector3(0,0,0);
                var length = 2000;
                var color = 0xffff00;

				//建立三个方向上箭头辅助
                var YarrowHelper = new THREE.ArrowHelper(Ydir,origin,length,0xff0000);
                var ZarrowHelper = new THREE.ArrowHelper(Zdir,origin,length,0x0000ff);
                var XarrowHelper = new THREE.ArrowHelper(Xdir,origin,length,0x00ff00);
				//把箭头辅助加入 场景
                scene.add(YarrowHelper);
                scene.add(ZarrowHelper);
                scene.add(XarrowHelper);
			}

            if ( ! Detector.webgl ) Detector.addGetWebGLMessage();

			var container;
			var modelArray = new Array();
			var camera, scene, renderer;
			var orbitControls;
			var modelNode;
			var xzPlane,xyPlane,yzPlane;
			var axisHelper;
			var lastModelColor;
            var menuObj = {};
           	menuObj["显示坐标轴"] = true;
            menuObj["显示xz平面"] = false;
            menuObj["显示xy平面"] = false;
            menuObj["显示yz平面"] = false;
            var zuanTouDesignMenuObj = {};
            var daoBingDesignMenuObj = {};
            var yanChangGanDesignMenuObj = {};
            var searchMenuObj = {};
            var yanChangGanSearchMenuObj = {};
            var zuanTouSearchMenuObj = {};
            var tuZhiMuBanMenuObj = {};
            var jiShuYaoQiuMenuObj = {};
            var textureCube;
            var reflectMaterial;
			var m_globalGui = null;
			var m_globalGuiJsonObj = null;
            var m_globalFuncUpdateModel = null;
            var m_globalGenerateModelStep = 1;
            var m_globalHandleSearchGui = null;
            var m_globalHandleSearchJsonObj = null;
            var m_globalSelectedZuanTouId = null;
            var m_globalSelectedDaoBingId = null;
            var m_globalSelectedYanChangGanId = null;
            var m_globalYanChangGanSearchGui = null;
            var m_globalYanChangGanSearchJsonObj = null;
            var m_globalTuZhiSearchGui = null;
            var m_globalTuZhiSearchJsonObj = null;
            var m_globalJiShuYaoQiuGui = null;
            var m_globalJiShuYaoQiuJsonObj = null;
            var m_globalSelectedZuanTouHandleLength = 0;
            var m_globalZuanTouSearchJsonResult = null;
            var m_globalDaoBinSearchJsonResult = null;
            var m_globalYanChangGanSearchJsonResult = null;
            var m_bYanChangGanBtnIsDisable = false;
			var mouseX = 0, mouseY = 0;

			var windowHalfX = window.innerWidth / 2;
			var windowHalfY = window.innerHeight / 2;

            function OnClickUpdateModel()
			{
			    menuObj["更新模型"]();
			}
			function CloseAllTab()
			{
			    LoadGUIByConfig();
			}
			function OnClickDownloadObj()
			{

			}
			function OnClickDownloadStp()
			{

			}
			function OnClickDownloadAllModel()
			{

			}
			function OnClickDownloadPdf()
			{

			}
			function IsAccessibleToDownload()
			{

			}

            function onClickUpdateModel(geometry,handleLength,yRotate)
            {
                var material = null;
                if (geometry.hasColors)
                {
                    material = new THREE.MeshPhongMaterial({ opacity: geometry.alpha, vertexColors: THREE.VertexColors });
                }
                else
                {
                    material = new THREE.MeshPhongMaterial( { color: 0xAAAAAA, specular: 0x111111, shininess: 0 } );
                }

                var mesh = new THREE.Mesh( geometry, material );

                mesh.position.set(handleLength, 0, 0);

                if(yRotate != undefined)
				{
                    mesh.rotation.set( 0, yRotate, 0 );
				}
				else
				{
                    mesh.rotation.set( 0, Math.PI * 0.5, 0 );
				}

                mesh.scale.set( 1,1,1 );

                mesh.castShadow = true;
                mesh.receiveShadow = true;

                //object.position.y = - 95;
                scene.add( mesh );
                modelArray.push(mesh);

                modelNode = mesh;
            }
            function removeAllSceneModel()
			{
			    var i = 0;
			    for(i = 0; i < modelArray.length; i++)
				{
				    scene.remove(modelArray[i]);
				}

				modelArray = new Array();
			}
			function HideProgressBar()
			{
                var elem = document.getElementById('myCanvas');
                elem.style.visibility = "hidden";
                clearInterval(progressTimer);
			}
            function onCallBack(response,handleLength)
			{
                var onProgress = function ( xhr ) {

                };

                var onError = function ( xhr ) {
                };

                var elem = document.getElementById('myCanvas');
                elem.style.visibility = "hidden";
                clearInterval(progressTimer);

                removeAllSceneModel();

                var jsonObj = eval('(' + response + ')');
                var modelFileList = jsonObj.ModelFileList;
                var pdfFile = jsonObj.PdfList;
                var pdfCtrl = document.getElementById( 'pdfCtrl' );
                pdfCtrl.src = globalServerAddr + pdfFile;

                var i = 0;
				var requestURL = globalServerAddr + modelFileList;

				var loader = new THREE.STLLoader();
				loader.load(requestURL, function ( geometry ){
					onClickUpdateModel(geometry,handleLength);
				},onProgress,onError);
			}
			function onUpdateMenu()
			{
                ReloadDesignGUI(m_globalGuiJsonObj);
			}

			function onClickUpdateCallBack()
			{
			    //这里显示进度条，并且把界面封印起来
                m_globalGenerateModelStep = 1;
                progressBarPercent = 0;

                var elem = document.getElementById('myCanvas');
                elem.style.visibility = "visible";

                progressTimer = setInterval(onUpdateProgress,100);
			}
			
			LoadZuanTouSearchGUIMockData("config/zuantou_search_menu_1.json",zuanTouSearchMenuObj,onSearchZuanTouCallBackMockData);
            LoadHandleSearchGUIMockData("config/handle_config_1.json",searchMenuObj,onSearchDaoBingCallBackMockData);
            LoadYanChangGanSearchGUIMockData("config/yanchanggan_config_1.json",yanChangGanSearchMenuObj,onSearchYanChangGanCallBackMockData,ReloadYanChangGanSearchMenu);
            LoadDesignGUIMockData("config/config.json",onCallBack,zuanTouDesignMenuObj,onClickUpdateCallBack,onUpdateMenu);
            LoadDaoBingDesignGUIMockData("config/HandleDesignConfig1.json",onCallBack,daoBingDesignMenuObj,onClickUpdateCallBack,onUpdateMenu);
            LoadYanChangGanDesignGUIMockData("config/YanChangGanDesignConfig1.json",onCallBack,yanChangGanDesignMenuObj,onClickUpdateCallBack,onUpdateMenu);
            LoadTuZhiMuBanGUI("config/tuZhiMuBan.json",tuZhiMuBanMenuObj,onTuZhiMuBanClickQueDing);
            LoadJiShuYaoQiuGUI("config/jiShuYaoQiu.json",jiShuYaoQiuMenuObj,onJiShuYaoQiuClickQueDing);

            //litchking
			init();
			animate();

			UpdateParamList();

			function init()
			{
				container = document.getElementById( 'gameCanvas' );
				//container.width = 800;
				//container.height = 600;
				//document.body.appendChild( container );

				camera = new THREE.PerspectiveCamera( 45, 1920 / 820, 0.01, 2000 );
				camera.position.z = 260;
                camera.position.x = 0;

				// scene

				scene = new THREE.Scene();

				var ambientLight = new THREE.AmbientLight( 0xcccccc, 0.4 );
				scene.add( ambientLight );

				var pointLight = new THREE.PointLight( 0xffffff, 0.8 );
				camera.add( pointLight );
				scene.add( camera );

                axisHelper = new THREE.AxisHelper(1000);
                axisHelper.material.depthTest = false;
                scene.add(axisHelper);

                var planeGeometry = new THREE.PlaneGeometry(60,40,10,10);
                //平面材质，基本材质是渲染不出阴影的，下面的材质可以，仅仅指定颜色
                var planeMaterial = new THREE.MeshLambertMaterial({color:0xff00dd});
                planeMaterial.wireframe = true;
                //以给定的尺寸和材质构建一个平面
                xzPlane = new THREE.Mesh(planeGeometry,planeMaterial);
                //指定平面的旋转角度，方便观察
                xzPlane.rotation.x = -0.5 * Math.PI;
                //平面的位置
                xzPlane.position.x = 0;
                xzPlane.position.y = 0;
                xzPlane.position.z = 0;
                //平面加入场景
                scene.add(xzPlane);

                planeMaterial = new THREE.MeshLambertMaterial({color:0x00ffdd});
                planeMaterial.wireframe = true;
                yzPlane = new THREE.Mesh(planeGeometry,planeMaterial);
                yzPlane.rotation.y = -0.5 * Math.PI;
                yzPlane.position.x = 0;
                yzPlane.position.y = 0;
                yzPlane.position.z = 0;
                scene.add(yzPlane);

                planeMaterial = new THREE.MeshLambertMaterial({color:0xffdd00});
                planeMaterial.wireframe = true;
                xyPlane = new THREE.Mesh(planeGeometry,planeMaterial);
                //指定平面的旋转角度，方便观察
                xyPlane.rotation.z = -0.5 * Math.PI;
                //平面的位置
                xyPlane.position.x = 0;
                xyPlane.position.y = 0;
                xyPlane.position.z = 0;
                //平面加入场景
                scene.add(xyPlane);

                var path = "../examples/textures/cube/skybox/";
                var urls = [
                    path + "px.jpg", path + "nx.jpg",
                    path + "py.jpg", path + "ny.jpg",
                    path + "pz.jpg", path + "nz.jpg"
                ];

                textureCube = new THREE.CubeTextureLoader().load( urls );
                reflectMaterial = new THREE.MeshPhongMaterial( { color: 0xe4e4e4, envMap: textureCube, side: THREE.DoubleSide } );

                //AddAxisArrowHelper(scene);

				// texture

				var manager = new THREE.LoadingManager();
				manager.onProgress = function ( item, loaded, total ) {

					console.log( item, loaded, total );

				};

				// model

				var onProgress = function ( xhr ) {
					if ( xhr.lengthComputable ) {
						var percentComplete = xhr.loaded / xhr.total * 100;
						console.log( Math.round(percentComplete, 2) + '% downloaded' );
					}
				};

				var onError = function ( xhr ) {
				};

				//var loader = new THREE.OBJLoader( manager );
                //var loader = new THREE.PLYLoader();
                var material = new THREE.MeshPhongMaterial( { color: 0xAAAAAA, specular: 0x111111, shininess: 200 } );
                var loader = new THREE.STLLoader();
				//loader.load( 'obj/male02/male02.obj', function ( object ) {
                loader.load( 'obj/test/edgewin.stl', function ( geometry ){
                //loader.load( 'http://localhost:1337', function ( geometry ) {
                    onClickUpdateModel(geometry,0,0);
				}, onProgress, onError );

				//

				renderer = new THREE.WebGLRenderer({
                    antialias: true,
                    alpha: true
				});
                this.renderer.setClearColor(0x000000, 0);
				renderer.setPixelRatio( window.devicePixelRatio );
				renderer.setSize( 1920,820 );
				container.appendChild( renderer.domElement );

                orbitControls = new THREE.OrbitControls( camera, renderer.domElement );
                orbitControls.minDistance = 5;
                orbitControls.maxDistance = 1000;
                orbitControls.maxPolarAngle = Math.PI;

				//document.addEventListener( 'mousemove', onDocumentMouseMove, false );

				//

				//window.addEventListener( 'resize', onWindowResize, false );

			}

			function onWindowResize() {

			    var width = 1920;
			    var height = 1080;
				windowHalfX = window.innerWidth / 2;
				windowHalfY = window.innerHeight / 2;

				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();

				renderer.setSize( window.innerWidth, window.innerHeight );

			}

			function onDocumentMouseMove( event ) {

				mouseX = ( event.clientX - windowHalfX ) / 2;
				mouseY = ( event.clientY - windowHalfY ) / 2;

			}

			//

			function animate() {

				requestAnimationFrame( animate );
				render();
			}

			function update()
			{
			    var i = 0;

			    for(i = 0; i < modelArray.length; i++)
				{
					modelArray[i].material = reflectMaterial;
				}

                axisHelper.visible = menuObj["显示坐标轴"];
                xzPlane.visible = menuObj["显示xz平面"];
                xyPlane.visible = menuObj["显示xy平面"];
                yzPlane.visible = menuObj["显示yz平面"];
			}
			function render() {


			    update();
				//camera.position.x += ( mouseX - camera.position.x ) * .05;
				//camera.position.y += ( - mouseY - camera.position.y ) * .05;

				//camera.lookAt( scene.position );
				renderer.render( scene, camera );
			}

		</script>

	</body>
</html>
